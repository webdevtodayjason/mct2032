[env:esp32-s3]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Board variant for Waveshare ESP32-S3-LCD-1.47
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; Dependencies
lib_deps = 
    lvgl/lvgl@^8.3.0
    moononournation/GFX Library for Arduino@^1.3.8
    bblanchon/ArduinoJson@^6.21.3
    h2zero/NimBLE-Arduino@^1.4.1
    adafruit/Adafruit NeoPixel@^1.11.0
    SD

; Build flags
build_flags = 
    -D LV_CONF_INCLUDE_SIMPLE
    -D LV_TICK_CUSTOM=1
    -D CONFIG_BT_NIMBLE_ENABLED
    -D CORE_DEBUG_LEVEL=3
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=0
    -D ARDUINO_USB_HID_ENABLED=1
    ; Increase stack sizes to prevent overflow
    -D CONFIG_BT_NIMBLE_HOST_TASK_STACK_SIZE=8192
    -D CONFIG_BT_NIMBLE_CONTROLLER_TASK_STACK_SIZE=8192
    -D CONFIG_ARDUINO_LOOP_STACK_SIZE=16384
    ; Optimize memory usage
    -D CONFIG_BT_NIMBLE_MAX_CONNECTIONS=1
    -D CONFIG_BT_NIMBLE_MAX_BONDS=1
    -D CONFIG_BT_NIMBLE_MAX_SERVICES=4
    -D CONFIG_BT_NIMBLE_MAX_ATTRS=20

; Custom board settings for Waveshare ESP32-S3-LCD-1.47
board_build.partitions = default_16MB.csv
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.psram_type = opi
board_build.psram_size = 8MB
board_upload.flash_size = 16MB
board_upload.maximum_size = 16777216
